<!DOCTYPE html>
<html>
<head><title>Dashboard</title></head>
<body>
<h2>Tenant Dashboard</h2>
<form method="POST" action="/create-widget">
  Widget Color: <input type="text" name="color" /><br/>
  <input type="hidden" id="tenantIdInput" name="tenantId" value="" />
  <button type="submit">Create Widget</button>
</form>

<h3>Agent List:</h3>
<table border="1" id="agentTable">
  <tr>
    <th>Agent ID</th>
    <th>Tenant ID</th>
    <th>Username</th>
    <th>Password</th>
  </tr>
</table>
<form method="POST" action="/create-agent">
  Agent Name: <input type="text" name="agentName" /><br/>
  Agent Password: <input type="password" name="agentPassword" /><br/>
  <input type="hidden" id="tenantIdInput2" name="tenantId" value="" />
  <button type="submit">Create Agent</button>
</form>

<p>Your Widget Code:</p>
<pre id="widgetCode"></pre>

<script>
  window.onload = function() {
    const urlParams = new URLSearchParams(window.location.search);
    const tenantId = urlParams.get('tenantId');
    document.getElementById("tenantIdInput").value = tenantId;
    document.getElementById("tenantIdInput2").value = tenantId;
    document.getElementById("widgetCode").textContent =
      "<script src='http://localhost:3000/widget.js?tenantId=" + tenantId + "'></" + "script>";
  
     // Load agent list after dashboard loads
    fetch(`/agent-list/${tenantId}`)
      .then(res => res.json())
      .then(agentList => {
        const table = document.getElementById("agentTable");
        agentList.forEach(agent => {
          const row = table.insertRow();
          row.insertCell(0).innerText = agent.agentId;
          row.insertCell(1).innerText = tenantId;
          row.insertCell(2).innerText = agent.username;
          row.insertCell(3).innerText = agent.plainPassword;
        });
      });
  }
</script>

</body>
</html>